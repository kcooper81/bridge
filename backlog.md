# TeamPrompt Backlog

## Completed
- [x] Member role dashboard restrictions
  - Settings layout: hide Billing & Plan tabs for members
  - Billing page: role gate (admin only message)
  - Plan & Usage tab: role gate (contact admin message)
  - UpgradeGate: member-aware messaging (no upgrade button, "contact admin")
  - Dashboard quick actions: "My Settings" instead of "Manage Team" for members
  - Payment banner: member-safe messaging (no billing links for members)
  - Templates: request+approval system for member installs
    - DB migration: `029_pack_install_requests.sql`
    - API: `/api/template-packs/request` (POST create, GET list)
    - API: `/api/template-packs/request/[requestId]` (PATCH approve/reject)
    - UI: "Request Install" button for members, "Requested" badge, admin approval banner
- [x] Extension install email system
  - API: `POST /api/invite/extension-email` (bulk or targeted, admin/manager only)
  - Auto-sends extension install email on invite accept (non-blocking)
  - Email links to `/extensions` page with browser store links
  - Rate limited (5/min per org)
- [x] Extension tab restructure: Faves, Recent, Prompts
  - Tabs: Faves (default) | Recent | Prompts — Shield removed, now overlay via status bar
  - Guardrails button in status bar with checkmark icon when active
  - "+ Add Rule" text button in status bar → opens dashboard guardrails page
- [x] Categories & tags filtering on all tabs
  - Filter bar (folder dropdown + tag multi-select) now shows on Faves, Recent, and Prompts tabs
- [x] Dashboard: hide settings cog from members
  - Settings gear dropdown hidden for member role
  - Organization tab in settings gated to admin/manager
- [x] Guardrails: member rule/policy suggestion flow
  - DB: `rule_suggestions` table (org_id, team_id nullable, suggested_by, name, description, category, severity, status, reviewed_by)
  - DB migration: `030_rule_suggestions.sql` with RLS policies
  - API: `POST /api/guardrails/suggest` (any org member can suggest)
  - API: `GET /api/guardrails/suggest` (admin/manager gets pending suggestions)
  - API: `PATCH /api/guardrails/suggest/[id]` (approve/reject with notes)

- [x] Marketing, Help Docs & Release Notes Update
  - **Phase 1: Fix inconsistencies**
    - Homepage: "3 members" → "1 member" on Free plan
    - Enterprise: "6 AI tools" → "5 AI tools" in stats
    - Help content: corrected plan info (Free: 1 member/25 prompts, Pro $9, Team $7/user, Business $12/user)
    - Help FAQs: corrected free plan description
  - **Phase 2: Update marketing pages**
    - Homepage: added Compliance Packs + Approval Queue to secondary features, updated analytics desc
    - Features: added 4 new sections (Compliance Packs, Auto-Sanitization, Approval Queue, Version Diff) with mockups
    - Security: added compliance packs grid (6 frameworks), auto-sanitization to benefits, updated How It Works step 02
    - Pricing: added Compliance Packs, Auto-Sanitization, Approval Queue, Version History & Diff rows
    - Enterprise: added Compliance Policy Packs to platform features + benefits, added compliance FAQ
  - **Phase 3: Help articles (7 new)**
    - Guardrails: "What are compliance policy packs?", "How does auto-sanitization work?", "How do I suggest a security rule?"
    - Prompt Vault: "How do I compare prompt versions?"
    - Getting Started: "How do I use the approval queue?"
    - Import/Export: "What are template packs?"
    - Analytics: updated existing article with effectiveness metrics mention
  - **Phase 4: New SEO pages**
    - Use cases: ai-dlp, prompt-management, ai-audit-trail (3 pages)
    - Comparisons: vs-custom-gpts, vs-prompt-managers (2 pages)
    - Industries: education + insurance (data files + page files)
    - Navigation: mega-menu + footer updated with Education, Insurance, Changelog
  - **Phase 5: Release notes system**
    - `src/lib/release-notes.ts` — data file with ReleaseNote interface, APP_VERSION, 4 releases
    - `src/components/dashboard/whats-new-modal.tsx` — modal + reusable ReleaseNotesList + useHasUnseenRelease hook
    - Support modal: added "What's New" tab with red dot indicator for unseen updates
    - Sidebar: version number display (v1.3.0) with unseen dot, clickable to open What's New
    - `src/app/(marketing)/changelog/page.tsx` — public changelog page with SEO metadata

- [x] Two-Factor Authentication (TOTP) for Admins & Managers
  - `qrcode` dependency installed
  - `types.ts`: `require_mfa_for_admins` in Organization settings
  - `supabase/middleware.ts`: returns AAL data
  - `middleware.ts`: `/verify-mfa` route + AAL1→AAL2 redirect
  - `verify-mfa/page.tsx`: MFA verification page (6-digit TOTP code)
  - `login/page.tsx`: post-login MFA check
  - `two-factor-card.tsx`: enrollment card (QR, secret, verify, disable)
  - `settings/page.tsx`: renders 2FA card for admin/manager
  - `organization-tab.tsx`: "Require 2FA" toggle in org preferences
  - `mfa-required-banner.tsx`: non-dismissible amber banner for enforcement
  - `layout.tsx`: renders MFA banner in dashboard
  - Privacy policy & terms of use updated with 2FA data handling + liability

- [x] Compliance Policy Template Packs
  - SOC 2 template added to `compliance-templates.ts` (6 frameworks total: HIPAA, PCI-DSS, GDPR, CCPA, General PII, SOC 2)
  - Compliance pack browser UI in Guardrails → Policies tab (grid with preview modal, install states, rule count badges)
  - One-click install function in `vault-api.ts` with name-based de-duplication
  - Feature gating: requires `custom_security` subscription + admin/manager role
- [x] Auto-Sanitization with Placeholders
  - Scan endpoint returns `sanitized_content` with `{{CATEGORY_N}}` placeholders
  - Extension UI: "Send Sanitized Version" button on violation block
  - Sanitized preview with highlighted placeholders, `action_taken: "auto_redacted"` logging
- [x] Prompt Effectiveness Analytics
  - `getEffectivenessMetrics()` in vault-api: top/least effective, rating distribution, unrated high-usage
  - UI section in Analytics page: rating distribution bars, top/least effective tables, needs-attention list
- [x] Approval Queue Dashboard
  - `/approvals` page with Prompts + Rule Suggestions tabs (`approvals/page.tsx`, 626 lines)
  - Approve/reject actions with optional reason modal
  - Sidebar nav item with pending count badge (admin/manager only)
  - API: `getPendingPrompts()`, `approvePrompt()`, `rejectPrompt()` in vault-api.ts
  - Extras: prompt preview modal, create-rule-from-suggestion flow, dismiss action
- [x] Version History Diff View
  - Migration: `changed_by` column on `prompt_versions` (`031_version_metadata.sql`)
  - `computeLineDiff()` utility (LCS-based line diff) in `src/lib/diff.ts`
  - Compare button in prompt modal showing inline diff with green/red highlighting
  - `updatePrompt()` stores `changed_by: user.id`
  - Extras: restore button, attribution (who + when), up to 10 versions, active state highlighting
- [x] Avatar Upload
  - API: `POST /api/profile/avatar` — validates file type/size, uploads to Supabase Storage `avatars` bucket
  - API: `DELETE /api/profile/avatar` — removes avatar from storage + clears profile URL
  - Profile tab: clickable avatar with hover overlay (Camera icon), drag-and-drop support
  - X button to remove avatar, syncs `avatar_url` in both profiles table and auth metadata
  - 2 MB max, JPEG/PNG/WebP/GIF supported
- [x] Email Address Change
  - API: `POST /api/profile/email` — users can change own email, admins can change non-admin member emails
  - Profile tab: email field is now editable with inline "Update" button
  - Team page: admins see pencil icon on non-admin members to change their email via modal
  - Security: admins cannot change other admins' emails, must be same org, duplicate email check
- [x] Manage Categories — Button + Modal Redesign
  - Replaced inline collapsible FolderManager with a button that opens the modal
  - Added color picker (12 preset colors) to create and edit flows
  - Colors saved to `folders.color` via existing `saveFolderApi`
  - Both list and grid views show color-coded folder icons
  - Color picker inline in both create form and edit form

- [x] Bulk Employee Import & Integrations Page
  - Bulk CSV import modal: file upload, paste, column mapping preview, validation (green/yellow/red), progress bar, results summary
  - API: `POST /api/invite/bulk` — validates rows, checks plan limits, auto-creates teams, batch invites via Resend
  - `bulkInvite()` client function in vault-api.ts
  - `BulkImportRow` and `BulkImportResult` types
  - "Import Members" button on team page
  - Integrations settings page (`/settings/integrations`) with cards for Google Workspace, Microsoft Entra ID (coming soon), SCIM 2.0 (coming soon)
  - Integrations link card in Organization settings tab

- [x] Google Workspace Directory Sync
  - Migration: `035_workspace_integrations.sql` — `workspace_integrations` table (org_id, provider, tokens, admin_email, timestamps)
  - API: `GET /api/integrations/google/connect` — builds OAuth URL with directory scopes, CSRF state cookie
  - API: `GET /api/integrations/google/callback` — exchanges code, gets admin email, upserts integration
  - API: `GET /api/integrations/google/status` — returns connected state, admin email, last sync time
  - API: `POST /api/integrations/google/sync` — fetches users (paginated, cap 2000) + groups, returns BulkImportRow[]
  - API: `DELETE /api/integrations/google/disconnect` — revokes token, deletes integration
  - Integrations page: connected/disconnected state, Sync Now → opens bulk import modal with pre-populated rows
  - Bulk import modal: `initialRows` prop skips input step, goes straight to preview

- [x] Domain-Based Auto-Join
  - Organization settings: `auto_join_domain` toggle in Preferences card (disabled when no domain set)
  - API: `POST /api/auth/domain-join` — checks email domain, finds matching org with auto_join enabled, migrates solo personal org
  - Skips free providers (gmail, yahoo, outlook, etc.)
  - org-provider: fire-and-forget call after auth, refreshes if user auto-joined

- [x] Welcome Email Customization
  - Organization settings: `invite_welcome_message` in types.ts (JSONB, no migration)
  - New "Invite Email" card in org settings with Textarea (max 500 chars, char counter)
  - Invite send route: prepends escaped welcome message as styled blockquote
  - Invite bulk route: same welcome message blockquote in batch emails

- [x] Bulk Role Assignment
  - Team page: `selectedMemberIds` state with Checkbox in table header (select all non-self) and per-row
  - Bulk action bar: "{N} selected" + role Select + Apply + Clear buttons
  - `handleBulkRoleChange()`: guards last-admin, Promise.all updateMemberRole, clears selection
  - Selection clears after individual role changes and member removal

- [x] SEO Internal Linking for 100 Solution Pages
  - Solutions index (`/solutions`): shows all 8 categories (was 3) — added alternative, guide, workflow, role, template
  - Related Solutions cross-links: 6-card "Related Solutions" section on every individual solution page (`getRelatedPages` helper)
  - Mega-menu: "By Use Case" links now point to actual solution pages (Prompt Library, AI Governance, DLP & Compliance, Prompt Templates) + "Browse all solutions" CTA
  - Footer: new "Solutions" column with links to /solutions and category anchors
  - Sitemap: added `/solutions` to core pages (weekly, 0.8 priority)

- [x] Fix admin panel crash (AuthProvider missing)
  - Admin layout now wraps children with `AuthProvider` (fetches session server-side)
  - Fixes "useAuth must be used within an AuthProvider" error on `/admin/admin-users`

- [x] Media page: switch extension mockups to light mode
  - DLPBlockScene and InsertScene converted from dark theme to light theme (white bg, zinc borders)
  - Banners stay dark, mockups on top are now light — matches VaultScene and AnalyticsScene

## Pending
- [ ] Microsoft Entra ID (Azure AD) directory sync
- [ ] SCIM 2.0 provisioning endpoint (for Okta, OneLogin, JumpCloud)
- [ ] SAML SSO
- [ ] Auto-deprovisioning (remove access when employee leaves directory)
